<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="Creative - Bootstrap 3 Responsive Admin Template">
  <meta name="author" content="GeeksLabs">
  <meta name="keyword" content="Creative, Dashboard, Admin, Template, Theme, Bootstrap, Responsive, Retina, Minimal">
  <link rel="shortcut icon" href="img/favicon.png">
  <!-- Page level plugin CSS-->
  <link href="../js/datatables/dataTables.bootstrap4.css" rel="stylesheet">

  <title>Blank | Creative - Bootstrap 3 Responsive Admin Template</title>

  <!-- Bootstrap CSS -->
  <link href="../css/bootstrap.min.css" rel="stylesheet">
  <!-- bootstrap theme -->
  <link href="../css/bootstrap-theme.css" rel="stylesheet">
  <!--external css-->
  <!-- font icon -->
  <link href="../css/elegant-icons-style.css" rel="stylesheet" />
  <link href="../css/font-awesome.min.css" rel="stylesheet" />
  <!-- Custom styles -->
  <link href="../css/style.css" rel="stylesheet">
  <link href="../css/style-responsive.css" rel="stylesheet" />

  <!-- HTML5 shim and Respond.js IE8 support of HTML5 -->
  <!--[if lt IE 9]>
      <script src="js/html5shiv.js"></script>
      <script src="js/respond.min.js"></script>
      <script src="js/lte-ie7.js"></script>
    <![endif]-->

    <!-- =======================================================
      Theme Name: NiceAdmin
      Theme URL: https://bootstrapmade.com/nice-admin-bootstrap-admin-html-template/
      Author: BootstrapMade
      Author URL: https://bootstrapmade.com
    ======================================================= -->
</head>

<body>
  <!-- container section start -->
  <section id="container" class="">
    <!--header start-->

    <header class="header dark-bg">
      <div class="toggle-nav">
        <div class="icon-reorder tooltips" data-original-title="Toggle Navigation" data-placement="bottom"><i class="icon_menu"></i></div>
      </div>

      <!--logo start-->
      <a href="index.html" class="logo">Sistema <span class="lite">Montessori</span></a>
      <!--logo end-->

      <div class="nav search-row" id="top_menu">
        <!--  search form start -->
        <ul class="nav top-menu">
          <li>
            <form class="navbar-form">
              <input class="form-control" placeholder="Search" type="text">
            </form>
          </li>
        </ul>
        <!--  search form end -->
      </div>

      <div class="top-nav notification-row">
        <!-- notificatoin dropdown start-->

      </div>
    </header>
    <!--header end-->

    <!--sidebar start-->
    <aside>
      <div id="sidebar" class="nav-collapse ">
        <!-- sidebar menu start-->
        <ul class="sidebar-menu">
          <li class="">
            <a class="" href="CursosAdministrador.html">
                          <i class="icon_pens"></i>
                          <span>Cursos</span>
                      </a>
          </li>
          <li class="sub-menu">
            <a href="TemasInteresAdministrador.html" class="">
                          <i class="icon_document_alt"></i>
                          <span>Temas de Interés</span>
                      </a>
          </li>
          <li class="sub-menu">
            <a href="AvisosAdministrador.html" class="">
                          <i class="icon_info_alt"></i>
                          <span>Avisos</span>
                      </a>
          </li>
          <li>
            <a class="" href="UsuariosAdministrador.html">
                          <i class="icon_profile"></i>
                          <span>Usuarios</span>
                      </a>
          </li>
          <li>
            <a class="" href="GruposAdministrador.html">
                          <i class="icon_group"></i>
                          <span>Grupos</span>
                      </a>
          </li>
          <li class="sub-menu">
            <a onclick="salir()" href="#" class="">
                          <i class="icon_close_alt2"></i>
                          <span>Salir</span>
                      </a>
          </li>
        </ul>
        <!-- sidebar menu end-->
      </div>
    </aside>
    <!--sidebar end-->

    <!--main content start-->
    <section id="main-content">
      <section class="wrapper">
        <div class="row">
          <div class="col-lg-12">
            <h3 class="page-header"><i class="fa fa fa-bars"></i> Contenido</h3>
            <ol class="breadcrumb">
              <li><i class="fa fa-home"></i><a href="GruposAdministrador.html">Grupos</a></li>
            </ol>
          </div>
        </div>
        <!-- page start-->
        <div>
          <button type="button" data-toggle="modal" onclick="crearGrupo()" class="btn btn-success pull-right">Crear Grupo</button>
        </div>
            <br>
            <br>

        <div class="row">
        <div class="col-lg-12">
          <section class="panel">
            <header class="panel-heading">
            </header>
            <div class="table-responsive">
              <table class="table" id="tabla_grupos">
                <thead>
                  <tr>
                    <th>Nombre</th>
                    <th>Grado</th>
                    <th>Nivel</th>
                    <th>Acciones</th>
                  </tr>
                </thead>
                <tbody id="cuerpo_tabla">
                </tbody>
              </table>
            </div>

          </section>
        </div>
      </div>
        <!-- page end-->
        <!-- Modal Listado Alumnos-->
          <div class="modal fade" id="modal_alumnos" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
            <div class="modal-dialog" role="document">
              <div class="modal-content">
                <div class="modal-header">
                  <h5 class="modal-title" id="tipo_opcion"></h5>
                  <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                  </button>
                </div>
                <div class="modal-body">
                  <h5>Agregar Alumnos:</h5>
                  <div class="table-responsive">
                    <table class="table" id="tabla_alumnos">
                      <thead>
                        <tr>
                          <th>Nombre del Alumno</th>
                          <th>Acciones</th>
                        </tr>
                      </thead>
                      <tbody id="cuerpo_tabla_alumnos">
                      </tbody>
                    </table>
                  </div>
                </div>
                <div class="modal-footer">
                  <button type="button" class="btn btn-primary"  data-dismiss="modal">Aceptar</button>
                </div>
              </div>
            </div>
          </div>
          <!-- Modal mensaje error-->
            <div class="modal fade" id="modalError" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
              <div class="modal-dialog" role="document">
                <div class="modal-content">
                  <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel">ATENCION</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                      <span aria-hidden="true">&times;</span>
                    </button>
                  </div>
                  <div class="modal-body" align="center">
                    <h3 id="mensajeError"></h3>
                  </div>
                  <div class="modal-footer">
                    <button type="button" class="btn btn-primary" data-dismiss="modal">Aceptar</button>
                  </div>
                </div>
              </div>
            </div>
      <!-- modales -->
      <!-- Modal -->
        <div class="modal fade" id="modal_crear_grupo" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
          <div class="modal-dialog" role="document">
            <div class="modal-content">
              <div class="modal-header">
                <h5 class="modal-title" id="tipo_opcion"></h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                  <span aria-hidden="true">&times;</span>
                </button>
              </div>
              <div class="modal-body">
                <h5>Dato del usuario:</h5>
                  <form>
                      <div class="row">
                        <div class="form-group col-md-12">
                            <label for="nombre">Nombre del Grupo:</label>
                            <input type="text" class="form-control" id="nombre_grupo" placeholder="Ejemplo: 5to A, Taller 2, Preescolar 1">
                        </div>

                        <div class="form-group">
                          <div class="col-md-6">
                            <label for="telefono">Grado:</label>
                            <input type="number" class="form-control" id="nivel_grupo" min="1" value="1" placeholder="Ejemplo: 1">

                          </div>
                            <div class="col-md-6">
                                <label for="edad">Nivel:</label>
                                <input type="text" class="form-control" id="grado_grupo" placeholder="Ejemplo: Primaria">
                            </div>
                        </div>
                      </div>
                    </form>
              </div>
              <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancelar</button>
                <button type="button" class="btn btn-primary"  onclick="guardarGrupo()">Guardar</button>
              </div>
            </div>
          </div>
        </div>
        <!-- MODALES -->
        <!-- Modal ELIMINAR USUARIO -->
          <div class="modal fade" id="modalEliminarGrupo" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
            <div class="modal-dialog" role="document">
              <div class="modal-content">
                <div class="modal-header">
                  <h5 class="modal-title" id="exampleModalLabel">ATENCION</h5>
                  <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                  </button>
                </div>
                <div class="modal-body" align="center">
                  <h3>¿Esta seguro de querer eliminar este grupo?</h3>
                  <h3>Los alumnos inscritos a este grupo serán desvinculados.</h3>
                  <input type="text" value="" style="display: none" id="input_valor_eliminar"/>
                </div>
                <div class="modal-footer">
                  <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancelar</button>
                  <button type="button" class="btn btn-primary" data-dismiss="modal" onclick="elimina()">Estoy Seguro</button>
                </div>
              </div>
            </div>
          </div>
      <!-- modales -->
      </section>
    </section>
    <!--main content end-->
    <div class="text-right">
      <div class="credits">
          <!--
            All the links in the footer should remain intact.
            You can delete the links only if you purchased the pro version.
            Licensing information: https://bootstrapmade.com/license/
            Purchase the pro version form: https://bootstrapmade.com/buy/?theme=NiceAdmin
          -->
        </div>
    </div>
  </section>
  <!-- container section end -->
  <!-- javascripts -->
  <script src="../js/jquery.js"></script>
  <script src="../js/bootstrap.min.js"></script>
  <!-- nice scroll -->
  <script src="../js/jquery.scrollTo.min.js"></script>
  <script src="../js/jquery.nicescroll.js" type="text/javascript"></script>
  <!--custome script for all page-->
  <script src="../js/scripts.js"></script>
  <script src="../js/gestion_cuenta.js"></script>
    <script src="../js/datatables/jquery.dataTables.js"></script>
    <script src="../js/datatables/dataTables.bootstrap4.js"></script>

</body>

</html>

<script>
  var tabla_alumnos;
  var grupo;
  var tabla;
  $( window ).load(function() {
      traeGrupos();
  });
  function traeGrupos(){
      //console.log("Traer Usuaios");
      var dataForm = new FormData();
      dataForm.append('user','user');
      var pagina = "../controller/traer_grupos.php";
      $.ajax({
       contentType: false,
       processData: false,
         // la URL para la petición
         url : pagina,
         // la información a enviar
         // (también es posible utilizar una cadena de datos)
         data : dataForm,
         // especifica si será una petición POST o GET
         type : 'POST',
         // el tipo de información que se espera de respuesta
         dataType : 'json',
         // código a ejecutar si la petición es satisfactoria;
         // la respuesta es pasada como argumento a la función
         success : function(json) {
           for(var i=0;i<json["total"];i++){//recorremos los tramites
             var id_grupo = json['grupos'][i]['id_grupo'];
                   $("#tabla_grupos").append(
                     "<tr id=grupo-'"+id_grupo+"'>"+
                         "<td id='td_nombre_"+id_grupo+"'>"+json["grupos"][i]["nombre_grupo"]+
                         "<td id='td_grado_"+id_grupo+"'>"+json["grupos"][i]["grado"]+
                         "<td id='td_grupo_"+id_grupo+"'>"+json["grupos"][i]["nivel"]+
                         "</td><td>"+"<a href='#' value='"+id_grupo+"' onclick='agregarAlumnos(this)'>Agregar Alumnos</a>&nbsp;/&nbsp;"+
                          "<a href='#' value='"+id_grupo+"' onclick='eliminaGrupo(this)'>Eliminar Grupo</a>"+
                         "</td>"+
                     "</tr>"
                 );
              }//
             tabla=$("#tabla_grupos").DataTable({
               searching:false,
               lengthChange: false,
               info:false,
               pageLength: 10,
               language:{
                 emptyTable	:	"No hay datos para mostrar en la tabla",
                 zeroRecords	:	"No hay datos para mostrar en la tabla",
                 paginate:{
                   "first":      "Primero",
                   "last":       "Ultimo",
                   "next":       "Siguiente",
                   "previous":   "Anterior"
                 }
               }
             });//*/
     },
     error : function(xhr, status) {
       alert("Existió un error en el servidor...");
            //location.href ="../index.html";
     },
     // código a ejecutar sin importar si la petición falló o no
     complete : function(xhr, status) {
         //alert('Petición realizada');
     }
   });//Fin ajax*/
  }

  function agregarAlumnos(elemento){
    var id_grupo = $(elemento).attr('value');
    //console.log("agregar a grupo: " + id_grupo);
    grupo=id_grupo;
    trae_alumnos();
  }
  function trae_alumnos(){
    var dataForm = new FormData();
    dataForm.append('id_grupo',grupo);
    var pagina = "../controller/traer_alumnos.php";
    $.ajax({
     contentType: false,
     processData: false,
       // la URL para la petición
       url : pagina,
       // la información a enviar
       // (también es posible utilizar una cadena de datos)
       data : dataForm,
       // especifica si será una petición POST o GET
       type : 'POST',
       // el tipo de información que se espera de respuesta
       dataType : 'json',
       // código a ejecutar si la petición es satisfactoria;
       // la respuesta es pasada como argumento a la función
       success : function(json) {
        $("#tabla_alumnos").DataTable().destroy();
         $("#cuerpo_tabla_alumnos").empty();
           for(var i=0;i<json["total"];i++){//recorremos los tramites
             if(json['usuarios'][i]){
               var id_alumno = json['usuarios'][i]['usuario'];
               var accion = "";
               if(json['estatus'][i]===0){
                 accion="</td><td>"+"<a href='#' value='"+id_alumno+"' onclick='enlazarAlumno(this)'>Inscribir</a>"
               }else if(json['estatus'][i]==1){
                 accion = "</td><td>En otro grupo";
               }else{
                 accion="</td><td>"+"<a href='#' value='"+id_alumno+"' onclick='desEnlazarAlumno(this)'>Eliminar</a>"
               }
                     $("#tabla_alumnos").append(
                       "<tr id=grupo-'"+id_alumno+"'>"+
                           "<td id='td_nombre_"+id_alumno+"'>"+json["usuarios"][i]["nombre"]+
                           accion+
                           "</td>"+
                       "</tr>"
                   );
             }
            }//*/
          tabla_alumnos=$("#tabla_alumnos").DataTable({
            searching:false,
            lengthChange: false,
            info:false,
            pageLength: 5,
            language:{
              emptyTable	:	"No hay datos para mostrar en la tabla",
              zeroRecords	:	"No hay datos para mostrar en la tabla",
              paginate:{
                "first":      "Primero",
                "last":       "Ultimo",
                "next":       "Siguiente",
                "previous":   "Anterior"
              }
            }
          });//*/
           $("#modal_alumnos").modal('show');
       },
       error : function(xhr, status) {
         alert("Existió un error en el servidor...");
              //location.href ="../index.html";
       },
       // código a ejecutar sin importar si la petición falló o no
       complete : function(xhr, status) {
           //alert('Petición realizada');
       }
     });//Fin ajax*/
  }

  function enlazarAlumno(elemento){
    var id_alumno = $(elemento).attr('value');
    var id_grupo = grupo;
    //console.log("Alumno "+id_alumno+" con "+id_grupo);
    var dataForm = new FormData();
    dataForm.append('id_usuario',id_alumno);
    dataForm.append('id_grupo',id_grupo);
    var pagina = "../controller/enlazar_alumno_grupo.php";
    $.ajax({
     contentType: false,
     processData: false,
       // la URL para la petición
       url : pagina,
       // la información a enviar
       // (también es posible utilizar una cadena de datos)
       data : dataForm,
       // especifica si será una petición POST o GET
       type : 'POST',
       // el tipo de información que se espera de respuesta
       dataType : 'json',
       // código a ejecutar si la petición es satisfactoria;
       // la respuesta es pasada como argumento a la función
       success : function(json) {
         if(json['exito']==true){
           //$(elemento).remove();
            $(elemento).attr('onclick','desEnlazarAlumno(this)');
           $(elemento).text('Eliminar');
         }else{
           $("#mensajeError").text(json['error']);
           $("#modalError").modal('show');//Modal de mensaje de errors
         }
       },
       error : function(xhr, status) {
         alert("Existió un error en el servidor...");
              //location.href ="../index.html";
       },
       // código a ejecutar sin importar si la petición falló o no
       complete : function(xhr, status) {
           //alert('Petición realizada');
       }
     });//Fin ajax*/
  }

  function desEnlazarAlumno(elemento){
    var id_alumno = $(elemento).attr('value');
    //alert(id_usuario);
    var id_grupo = grupo;
    //console.log("DESVINCULAR Alumno "+id_alumno+" con grupo"+id_grupo);
    var dataForm = new FormData();
    dataForm.append('id_usuario',id_alumno);
    dataForm.append('id_grupo',id_grupo);
    var pagina = "../controller/desenlazar_alumno_grupo.php";
    $.ajax({
     contentType: false,
     processData: false,
       // la URL para la petición
       url : pagina,
       // la información a enviar
       // (también es posible utilizar una cadena de datos)
       data : dataForm,
       // especifica si será una petición POST o GET
       type : 'POST',
       // el tipo de información que se espera de respuesta
       dataType : 'json',
       // código a ejecutar si la petición es satisfactoria;
       // la respuesta es pasada como argumento a la función
       success : function(json) {
         if(json['exito']==true){
           //$(elemento).remove();
            $(elemento).attr('onclick','enlazarAlumno(this)');
           $(elemento).text('Inscribir');
         }else{
           $("#mensajeError").text(json['error']);
           $("#modalError").modal('show');//Modal de mensaje de errors
         }
       },
       error : function(xhr, status) {
         alert("Existió un error en el servidor...");
              //location.href ="../index.html";
       },
       // código a ejecutar sin importar si la petición falló o no
       complete : function(xhr, status) {
           //alert('Petición realizada');
       }
     });//Fin ajax*/
  }

  function recargarTablaGrupos(){
    $("#tabla_grupos").DataTable().destroy();
    $("#cuerpo_tabla").empty();
    traeGrupos();
  }

  function eliminaGrupo(elemento){
    var id_grupo = $(elemento).attr('value');
    $("#input_valor_eliminar").val(id_grupo);
    $("#modalEliminarGrupo").modal('show');
  }

  function elimina(){
    var id_grupo = $(input_valor_eliminar).val();
    //console.log("eliminar grupo: " + id_grupo);
    //var id_td = "#"
    var dataForm = new FormData();
    dataForm.append('id_grupo',id_grupo);
    var pagina = "../controller/eliminar_grupo.php";
    $.ajax({
     contentType: false,
     processData: false,
       // la URL para la petición
       url : pagina,
       // la información a enviar
       // (también es posible utilizar una cadena de datos)
       data : dataForm,
       // especifica si será una petición POST o GET
       type : 'POST',
       // el tipo de información que se espera de respuesta
       dataType : 'json',
       // código a ejecutar si la petición es satisfactoria;
       // la respuesta es pasada como argumento a la función
       success : function(json) {
          if(json['exito'] == true){
            $("#mensajeError").text("El grupo ha sido borrado exitosamente");
            $("#modalError").modal('show');//Modal de mensaje de errors
            recargarTablaGrupos();
          }else{
            $("#mensajeError").text(json['error']);
            $("#modalError").modal('show');//Modal de mensaje de errors
          }
         },
       error : function(xhr, status) {
         $("#mensajeError").text("Existió un error en el servidor...");
         $("#modalError").modal('show');//Modal de mensaje de errors
        //alert("Existió un error en el servidor...");
                //location.href ="../index.html";
       },
         // código a ejecutar sin importar si la petición falló o no
       complete : function(xhr, status) {
           //alert('Petición realizada');
       }
    });//fin de ajax*/
  }

  function crearGrupo(){
    $("#nombre_grupo").val("Taller ");
    $("#grado_grupo").val("Primaria");
    $("#modal_crear_grupo").modal('show');
  }
  function guardarGrupo(){
    var nombre = $("#nombre_grupo").val();
    var nivel = $("#nivel_grupo").val();
    var grado= $("#grado_grupo").val();
    var dataForm = new FormData();
    dataForm.append('nombre',nombre);
    dataForm.append('nivel',nivel);
    dataForm.append('grado',grado);
    var pagina = "../controller/crear_grupo.php";
    $.ajax({
     contentType: false,
     processData: false,
       // la URL para la petición
       url : pagina,
       // la información a enviar
       // (también es posible utilizar una cadena de datos)
       data : dataForm,
       // especifica si será una petición POST o GET
       type : 'POST',
       // el tipo de información que se espera de respuesta
       dataType : 'json',
       // código a ejecutar si la petición es satisfactoria;
       // la respuesta es pasada como argumento a la función
       success : function(json) {
          if(json['exito'] == true){
            var id_grupo = json['id_grupo'];
            var row = $("<tr id=grupo-'"+id_grupo+"'>");
            row.append("<td>"+nombre)
              .append("</td><td>"+grado)
              .append("</td><td>"+grado)
              .append("</td><td>"+"<a href='#' value='"+id_grupo+"' onclick='agregarAlumnos(this)'>Agregar Alumnos</a>&nbsp;/&nbsp;"+
               "<a href='#' value='"+id_grupo+"' onclick='eliminaGrupo(this)'>Eliminar Grupo</a>")
              .append("</td>")
              .append("</tr>");
              tabla.row.add(row);
              $("#tabla_grupos").prepend(row);
              $("#mensajeError").text("Grupo creado con exito.");
              $("#modalError").modal('show');//Modal de mensaje de errors
              $("#modal_crear_grupo").modal('toggle');
          }else{
            $("#mensajeError").text(json['error']);
            $("#modalError").modal('show');//Modal de mensaje de errors
          }
         },
       error : function(xhr, status) {
         $("#mensajeError").text("Existió un error en el servidor...");
         $("#modalError").modal('show');//Modal de mensaje de errors
        //alert("Existió un error en el servidor...");
                //location.href ="../index.html";
       },
         // código a ejecutar sin importar si la petición falló o no
       complete : function(xhr, status) {
           //alert('Petición realizada');
       }
    });//fin de ajax*/
  }
</script>
